<!DOCTYPE html>
<html lang="pt-BR">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
Â  <title>Praise FM Brasil â€” OuÃ§a ao Vivo</title>
Â  
Â  Â  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" as="style" />
Â  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'" />
Â  
Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
Â  
Â  Â  <link rel="stylesheet" href="style.css"> 
Â  
</head>
<body>
Â  <div class="container">
Â  Â  <div class="header">
Â  Â  Â  Â  Â  Â  <img src="https://i.imgur.com/5Y0Kx7d.png" alt="Praise FM Brasil" style="height: 24px;" />
Â  Â  Â  <button class="favorite-btn" id="favoriteBtn" title="Favoritar esta mÃºsica" aria-label="Favoritar esta mÃºsica">â˜†</button>
Â  Â  </div>

Â  Â  <div class="content">
Â  Â  Â  Â  Â  Â  <div class="station-title">Praise FM Brasil</div>
Â  Â  Â  <div class="station-desc">MÃºsica cristÃ£ & louvor 24/7</div>

Â  Â  Â  <div class="show-image" id="showImage">
Â  Â  Â  Â  Â  Â  Â  Â  <img id="coverImg" src="https://via.placeholder.com/200x200?text=Loading+Cover" alt="Capa da mÃºsica atual" />
Â  Â  Â  </div>

Â  Â  Â  <div class="show-info">
Â  Â  Â  Â  <div class="live-indicator">AO VIVO â€¢ <span id="currentTime">â€”</span></div>
Â  Â  Â  Â  <div class="show-title">
Â  Â  Â  Â  Â  <span id="currentTitle">Carregando...</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="show-date" id="currentDate">â€”</div>
Â  Â  Â  </div>

Â  Â  Â  <button class="play-button" id="playBtn" aria-label="Reproduzir ou pausar o stream">â–¶ Play</button>

Â  Â  Â  <div class="volume-control">
Â  Â  Â  Â  <label for="volumeSlider" class="sr-only">Ajustar volume</label>
Â  Â  Â  Â  <i class="fas fa-volume-up" aria-hidden="true"></i>
Â  Â  Â  Â  <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.01" value="0.7" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0.7" role="slider" />
Â  Â  Â  </div>

Â  Â  Â  <div class="history-section">
Â  Â  Â  Â  <div class="history-title">Tocadas Recentemente</div>
Â  Â  Â  Â  <div class="history-list" id="historyList">
Â  Â  Â  Â  Â  <div style="text-align:center;color:#666;padding:16px;">Nenhuma mÃºsica ainda...</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="status" id="status">Conectando ao stream... â€¢ AtualizaÃ§Ãµes em tempo real</div>
Â  Â  </div>
Â  </div>

Â  Â  <audio id="radioPlayer" preload="auto" aria-hidden="true"></audio>

Â  Â  <script>
Â  Â  // ðŸ”‘ ConfiguraÃ§Ãµes
Â  Â  const STREAM_URL = 'https://stream.zeno.fm/olisuxy9v3vtv'; 
Â  Â  const NOWPLAYING_API = 'https://api.zeno.fm/mounts/metadata/subscribe/olisuxy9v3vtv'; 
Â  Â  const LASTFM_API_KEY = '3ce134e4f02accfff4367ada927e6dcd'; 
Â  Â  const STREAM_LOGO_URL = 'https://raw.githubusercontent.com/webradiosagradafm/radiosagradafm/main/imagem/Logo%20Praise%20FM%20Brasil.png';
Â  Â  
Â  Â  const player = document.getElementById('radioPlayer');
Â  Â  const playBtn = document.getElementById('playBtn');
Â  Â  const volumeSlider = document.getElementById('volumeSlider');
Â  Â  const statusText = document.getElementById('status');
Â  Â  const coverImg = document.getElementById('coverImg');
Â  Â  const currentTitleEl = document.getElementById('currentTitle');
Â  Â  const currentDateEl = document.getElementById('currentDate');
Â  Â  const currentTimeEl = document.getElementById('currentTime');
Â  Â  const historyList = document.getElementById('historyList');
Â  Â  const favoriteBtn = document.getElementById('favoriteBtn');
Â  Â  const showImageEl = document.getElementById('showImage');

Â  Â  let playing = false;
Â  Â  let currentTrackKey = '';
Â  Â  const history = [];
Â  Â  const MAX_HISTORY = 5;
Â  Â  let currentSong = '';
Â  Â  let currentArtist = '';

Â  Â  player.crossOrigin = 'anonymous'; 
Â  Â  player.src = STREAM_URL;
Â  Â  player.volume = volumeSlider.value;

Â  Â  function updatePlayButton() {
Â  Â  Â  playBtn.textContent = playing ? 'â¸ Pause' : 'â–¶ Play';
Â  Â  Â  playBtn.setAttribute('aria-label', playing ? 'Pausar o stream' : 'Reproduzir o stream');
Â  Â  }

Â  Â  player.play().then(() => {
Â  Â  Â  playing = true;
Â  Â  Â  updatePlayButton();
Â  Â  Â  statusText.textContent = 'AO VIVO â€¢ Tocando agora';
Â  Â  }).catch(err => {
Â  Â  Â  console.warn('Autoplay bloqueado â€” interaÃ§Ã£o do usuÃ¡rio necessÃ¡ria');
Â  Â  Â  statusText.textContent = 'Clique em Play para ouvir.';
Â  Â  });

Â  Â  playBtn.addEventListener('click', () => {
Â  Â  Â  if (playing) {
Â  Â  Â  Â  player.pause();
Â  Â  Â  Â  statusText.textContent = 'Pausado';
Â  Â  Â  } else {
Â  Â  Â  Â  player.play().then(() => {
Â  Â  Â  Â  Â  statusText.textContent = 'AO VIVO â€¢ Tocando agora';
Â  Â  Â  Â  }).catch(err => {
Â  Â  Â  Â  Â  statusText.textContent = 'Falha no playback â€” tente novamente.';
Â  Â  Â  Â  Â  console.error('Erro de play:', err);
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  Â  playing = !playing;
Â  Â  Â  updatePlayButton();
Â  Â  });

Â  Â  volumeSlider.addEventListener('input', () => {
Â  Â  Â  player.volume = volumeSlider.value;
Â  Â  Â  volumeSlider.setAttribute('aria-valuenow', volumeSlider.value);
Â  Â  Â  statusText.textContent = `Volume: ${Math.round(player.volume * 100)}%`;
Â  Â  });

Â  Â  function updateTime() {
Â  Â  Â  const brasiliaTime = new Date().toLocaleString('pt-BR', { timeZone: 'America/Sao_Paulo' });
Â  Â  Â  const brasiliaDate = new Date(brasiliaTime);

Â  Â  Â  const timeFormatted = brasiliaDate.toLocaleTimeString('pt-BR', {
Â  Â  Â  Â  hour12: false,
Â  Â  Â  Â  hour: '2-digit',
Â  Â  Â  Â  minute: '2-digit'
Â  Â  Â  });

Â  Â  Â  const dateFormatted = brasiliaDate.toLocaleDateString('pt-BR', {
Â  Â  Â  Â  day: '2-digit',
Â  Â  Â  Â  month: 'short',
Â  Â  Â  Â  year: 'numeric'
Â  Â  Â  });

Â  Â  Â  currentTimeEl.textContent = timeFormatted;
Â  Â  Â  currentDateEl.textContent = dateFormatted; 
Â  Â  }

Â  Â  setInterval(updateTime, 1000);
Â  Â  updateTime();

Â  Â  function addToHistory(song, artist, coverUrl = '') {
Â  Â  Â  const key = `${artist} - ${song}`;
Â  Â  Â  if (key === currentTrackKey) return;
Â  Â  Â  currentTrackKey = key;

Â  Â  Â  const existing = history.findIndex(item => item.song === song && item.artist === artist);
Â  Â  Â  if (existing !== -1) history.splice(existing, 1);

Â  Â  Â  history.unshift({ song, artist, coverUrl });

Â  Â  Â  if (history.length > MAX_HISTORY) history.pop();

Â  Â  Â  renderHistory();
Â  Â  }

Â  Â  function renderHistory() {
Â  Â  Â  if (history.length === 0) {
Â  Â  Â  Â  historyList.innerHTML = '<div style="text-align:center;color:#666;padding:16px;">Nenhuma mÃºsica ainda...</div>';
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  historyList.innerHTML = history.map(item => {
Â  Â  Â  Â  const key = `${item.artist} - ${item.song}`;
Â  Â  Â  Â  const isFavorited = JSON.parse(localStorage.getItem('favorites') || '[]').includes(key) ? 'â˜…' : 'â˜†';
Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  <div class="history-item">
Â  Â  Â  Â  Â  Â  <div class="history-img">
Â  Â  Â  Â  Â  Â  Â  ${item.coverUrl && item.coverUrl !== STREAM_LOGO_URL ? `<img src="${item.coverUrl}" alt="${item.artist} - ${item.song}">` : '<i class="fas fa-music" style="color:#888;font-size:1.2rem;"></i>'}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="history-text">
Â  Â  Â  Â  Â  Â  Â  <div class="history-title-item">
Â  Â  Â  Â  Â  Â  Â  Â  ${item.song}
Â  Â  Â  Â  Â  Â  Â  Â  <span class="favorite-history" data-key="${key}" role="button" tabindex="0" aria-label="Favoritar ${item.artist} - ${item.song}">${isFavorited}</span>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div class="history-artist">${item.artist}</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  }).join('');

Â  Â  Â  document.querySelectorAll('.favorite-history').forEach(el => {
Â  Â  Â  Â  el.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  Â  toggleFavorite(el.dataset.key, el);
Â  Â  Â  Â  });
Â  Â  Â  Â  el.addEventListener('keydown', (e) => {
Â  Â  Â  Â  Â  if (e.key === 'Enter' || e.key === ' ') {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  toggleFavorite(el.dataset.key, el);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  }

Â  Â  function toggleFavorite(key, element = null) {
Â  Â  Â  let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
Â  Â  Â  const index = favorites.indexOf(key);

Â  Â  Â  if (index === -1) {
Â  Â  Â  Â  favorites.push(key);
Â  Â  Â  } else {
Â  Â  Â  Â  favorites.splice(index, 1);
Â  Â  Â  }

Â  Â  Â  localStorage.setItem('favorites', JSON.stringify(favorites));

Â  Â  Â  if (key === `${currentArtist} - ${currentSong}`) {
Â  Â  Â  Â  favoriteBtn.textContent = index === -1 ? 'â˜…' : 'â˜†';
Â  Â  Â  Â  favoriteBtn.classList.toggle('favorited', index === -1);
Â  Â  Â  Â  showImageEl.classList.toggle('favorited-cover', index === -1);
Â  Â  Â  }

Â  Â  Â  if (element) {
Â  Â  Â  Â  element.textContent = index === -1 ? 'â˜…' : 'â˜†'; 
Â  Â  Â  }

Â  Â  Â  updateFavoriteButton(); 
Â  Â  }

Â  Â  function updateFavoriteButton() {
Â  Â  Â  if (!currentSong || !currentArtist) return;
Â  Â  Â  const key = `${currentArtist} - ${currentSong}`;
Â  Â  Â  const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
Â  Â  Â  const isFavorited = favorites.includes(key);

Â  Â  Â  favoriteBtn.textContent = isFavorited ? 'â˜…' : 'â˜†';
Â  Â  Â  favoriteBtn.classList.toggle('favorited', isFavorited);
Â  Â  Â  showImageEl.classList.toggle('favorited-cover', isFavorited);
Â  Â  }

Â  Â  favoriteBtn.addEventListener('click', () => {
Â  Â  Â  if (!currentSong || !currentArtist) return;
Â  Â  Â  const key = `${currentArtist} - ${currentSong}`;
Â  Â  Â  toggleFavorite(key);
Â  Â  });

Â  Â  favoriteBtn.addEventListener('keydown', (e) => {
Â  Â  Â  if (e.key === 'Enter' || e.key === ' ') {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  if (!currentSong || !currentArtist) return;
Â  Â  Â  Â  const key = `${currentArtist} - ${currentSong}`;
Â  Â  Â  Â  toggleFavorite(key);
Â  Â  Â  }
Â  Â  });

Â  Â  function isCommercial(title) {
Â  Â  Â  const keywords = [
Â  Â  Â  Â  'commercial', 'advertisement', 'sponsor', 'spot', 'publicidade', 'intervalo', 'break', 'jingle', 'comercial', 'anÃºncio', 'patrocÃ­nio'
Â  Â  Â  ];
Â  Â  Â  const lower = title.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
Â  Â  Â  return keywords.some(k => lower.includes(k));
Â  Â  }

Â  Â  function fetchCoverArt(artist, song) {
Â  Â  Â  if (!artist || !song || isCommercial(song) || artist === 'Praise FM Brasil' || song === 'Streaming Live') {
Â  Â  Â  Â  Â  return Promise.resolve(STREAM_LOGO_URL); 
Â  Â  Â  }

Â  Â  Â  return fetch(
Â  Â  Â  Â  `https://ws.audioscrobbler.com/2.0/?method=track.getInfo&api_key=${LASTFM_API_KEY}&artist=${encodeURIComponent(artist)}&track=${encodeURIComponent(song)}&format=json`
Â  Â  Â  )
Â  Â  Â  Â  .then(res => res.json())
Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  if (data.track?.album?.image) {
Â  Â  Â  Â  Â  Â  const images = data.track.album.image;
Â  Â  Â  Â  Â  Â  const cover = images.find(img => img.size === 'extralarge') || images[images.length - 1];
Â  Â  Â  Â  Â  Â  return cover['#text'] || '';
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  return '';
Â  Â  Â  Â  })
Â  Â  Â  Â  .catch(err => {
Â  Â  Â  Â  Â  console.warn('Falha ao buscar capa:', err);
Â  Â  Â  Â  Â  return STREAM_LOGO_URL;
Â  Â  Â  Â  });
Â  Â  }

Â  Â  function isInvalidCover(imageUrl) {
Â  Â  Â  return new Promise((resolve) => {
Â  Â  Â  Â  const img = new Image();
Â  Â  Â  Â  img.onload = () => resolve(false);
Â  Â  Â  Â  img.onerror = () => resolve(true);
Â  Â  Â  Â  img.src = imageUrl;
Â  Â  Â  });
Â  Â  }

Â  Â  function setupNowPlaying() {
Â  Â  Â  const eventSource = new EventSource(NOWPLAYING_API);

Â  Â  Â  eventSource.onmessage = (event) => {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  const data = JSON.parse(event.data);
Â  Â  Â  Â  Â  let streamTitle = (data.streamTitle || '').trim() || 'Faixa desconhecida';

Â  Â  Â  Â  Â  streamTitle = streamTitle.replace(/[^\p{L}\p{N}\s\-â€“â€”.,:;!?'"()&@#$%*+=/\\|<>[\]{}~`^_]/gu, ' ').replace(/\s+/g, ' ').trim();

Â  Â  Â  Â  Â  if (!streamTitle || streamTitle.length < 3) {
Â  Â  Â  Â  Â  Â  streamTitle = 'Praise FM Brasil - Spot';
Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  const isSpot = isCommercial(streamTitle);

Â  Â  Â  Â  Â  if (isSpot) {
Â  Â  Â  Â  Â  Â  streamTitle = 'Praise FM Brasil - Spot';
Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  const parts = streamTitle.split(' - ').map(p => p.trim()).filter(Boolean);
Â  Â  Â  Â  Â  const artist = parts[0] || 'Praise FM Brasil';
Â  Â  Â  Â  Â  const song = parts.length > 1 ? parts.slice(1).join(' - ') : streamTitle;

Â  Â  Â  Â  Â  currentSong = song;
Â  Â  Â  Â  Â  currentArtist = artist;

Â  Â  Â  Â  Â  currentTitleEl.textContent = `${artist} - ${song}`;
Â  Â  Â  Â  Â  currentTitleEl.title = `${artist} - ${song}`;

Â  Â  Â  Â  Â  // Busca capa
Â  Â  Â  Â  Â  fetchCoverArt(artist, song).then(coverUrl => {
Â  Â  Â  Â  Â  Â  // Se a URL for VAZIA (mÃºsica sem capa no Last.fm) ou for um spot, usamos o logo padrÃ£o
Â  Â  Â  Â  Â  Â  if (!coverUrl || isSpot || coverUrl === STREAM_LOGO_URL) {
Â  Â  Â  Â  Â  Â  Â  coverImg.src = STREAM_LOGO_URL; 
Â  Â  Â  Â  Â  Â  Â  coverImg.alt = isSpot ? 'Comercial' : `${artist} - ${song}`;
Â  Â  Â  Â  Â  Â  Â  addToHistory(song, artist, coverImg.src); 

Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  isInvalidCover(coverUrl).then(isInvalid => {
Â  Â  Â  Â  Â  Â  Â  Â  if (isInvalid) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  coverImg.src = STREAM_LOGO_URL; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  coverImg.alt = `${artist} - ${song}`;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  coverImg.src = coverUrl;
Â  Â  Â  Â  Â  Â  Â  Â  Â  coverImg.alt = `${artist} - ${song}`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  addToHistory(song, artist, coverImg.src);
Â  Â  Â  Â  Â  Â  Â  }).catch(() => {
Â  Â  Â  Â  Â  Â  Â  Â  coverImg.src = STREAM_LOGO_URL; 
Â  Â  Â  Â  Â  Â  Â  Â  coverImg.alt = `${artist} - ${song}`;
Â  Â  Â  Â  Â  Â  Â  Â  addToHistory(song, artist, STREAM_LOGO_URL);
Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  updateFavoriteButton();

Â  Â  Â  Â  Â  Â  statusText.textContent = `AO VIVO â€¢ Agora: ${artist} - ${song}`;

Â  Â  Â  Â  Â  Â  if (isSpot) {
Â  Â  Â  Â  Â  Â  Â  statusText.textContent = 'ðŸ“¢ Este Ã© um comercial';
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  console.warn('Erro ao parsear metadados', err);
Â  Â  Â  Â  Â  currentTitleEl.textContent = 'Praise FM Brasil - Tocando ao vivo';
Â  Â  Â  Â  Â  coverImg.src = STREAM_LOGO_URL;
Â  Â  Â  Â  Â  statusText.textContent = 'AO VIVO â€¢ Tocando ao vivo';
Â  Â  Â  Â  }
Â  Â  Â  };

Â  Â  Â  eventSource.onerror = () => {
Â  Â  Â  Â  console.warn('Falha no EventSource, tentando novamente em 15s...');
Â  Â  Â  Â  setTimeout(setupNowPlaying, 15000);
Â  Â  Â  };
Â  Â  }

Â  Â  setupNowPlaying();
Â  Â  updatePlayButton();
Â  </script>
</body>
</html>
